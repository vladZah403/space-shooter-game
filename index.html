<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Space Shooter</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            overflow: hidden;
            background: linear-gradient(135deg, #0a0a1a 0%, #1a0a2e 50%, #0a0a1a 100%);
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            touch-action: none;
        }

        #gameCanvas {
            display: block;
            touch-action: none;
        }

        #ui {
            position: absolute;
            top: 10px;
            left: 10px;
            right: 10px;
            z-index: 10;
            pointer-events: none;
        }

        .stat-card {
            background: rgba(13, 27, 42, 0.9);
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 8px;
            padding: 6px 10px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 20px rgba(0, 255, 136, 0.2);
        }

        .stat-label {
            font-size: 9px;
            color: rgba(0, 255, 136, 0.7);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 1px;
        }

        .stat-value {
            font-size: 16px;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        #gameOver, #startScreen, #difficultyScreen {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(10, 10, 26, 0.95);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 30;
            backdrop-filter: blur(10px);
            overflow-y: auto;
            padding: 15px;
        }

        .game-card {
            background: linear-gradient(135deg, rgba(13, 27, 42, 0.98), rgba(26, 10, 46, 0.98));
            border: 2px solid rgba(0, 255, 136, 0.3);
            border-radius: 15px;
            padding: 20px 15px;
            max-width: 400px;
            width: 100%;
            box-shadow: 0 10px 50px rgba(0, 255, 136, 0.3);
            max-height: 90vh;
            overflow-y: auto;
        }

        .game-title {
            font-size: 32px;
            font-weight: bold;
            background: linear-gradient(135deg, #00ff88, #00d4ff);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-align: center;
            margin-bottom: 5px;
            animation: pulse 2s infinite;
            line-height: 1.2;
        }

        .game-subtitle {
            color: rgba(0, 255, 136, 0.7);
            text-align: center;
            margin-bottom: 20px;
            font-size: 11px;
            letter-spacing: 1.5px;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.03); }
        }

        .difficulty-card {
            background: rgba(13, 27, 42, 0.6);
            border: 2px solid rgba(0, 255, 136, 0.2);
            border-radius: 12px;
            padding: 12px;
            margin-bottom: 10px;
            cursor: pointer;
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .difficulty-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(0, 255, 136, 0.1), transparent);
            transition: left 0.5s;
        }

        .difficulty-card:active::before {
            left: 100%;
        }

        .difficulty-card:active {
            border-color: #00ff88;
            transform: scale(0.98);
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.3);
        }

        .difficulty-card.selected {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.15);
        }

        .difficulty-icon {
            font-size: 28px;
            margin-right: 12px;
            flex-shrink: 0;
        }

        .difficulty-name {
            font-size: 18px;
            font-weight: bold;
            color: #00ff88;
            margin-bottom: 3px;
        }

        .difficulty-description {
            font-size: 11px;
            color: rgba(255, 255, 255, 0.7);
            line-height: 1.3;
        }

        .btn-game {
            background: linear-gradient(135deg, #00ff88, #00d4ff);
            border: none;
            color: #0a0a1a;
            font-weight: bold;
            font-size: 16px;
            padding: 12px 30px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            text-transform: uppercase;
            letter-spacing: 1.5px;
            box-shadow: 0 5px 20px rgba(0, 255, 136, 0.4);
        }

        .btn-game:active {
            transform: scale(0.95);
        }

        .btn-secondary-game {
            background: rgba(13, 27, 42, 0.8);
            border: 2px solid rgba(0, 255, 136, 0.5);
            color: #00ff88;
            font-size: 14px;
            padding: 10px 25px;
        }

        .btn-secondary-game:active {
            background: rgba(0, 255, 136, 0.1);
        }

        #controls {
            position: absolute;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 15px;
            z-index: 10;
            flex-direction: column;
            align-items: center;
        }

        .controls-row {
            display: flex;
            gap: 15px;
        }

        .auto-shoot-indicator {
            background: rgba(13, 27, 42, 0.85);
            border: 2px solid rgba(0, 255, 136, 0.5);
            border-radius: 20px;
            padding: 6px 15px;
            color: #00ff88;
            font-size: 11px;
            display: flex;
            align-items: center;
            gap: 5px;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
            cursor: pointer;
            transition: all 0.3s;
            user-select: none;
        }

        .auto-shoot-indicator:active {
            transform: scale(0.95);
        }

        .auto-shoot-indicator.active {
            background: rgba(0, 255, 136, 0.2);
            border-color: #00ff88;
        }

        .auto-shoot-indicator i {
            font-size: 14px;
        }

        /* –°—Ç–∏–ª–∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ */
        .customize-section {
            margin-bottom: 20px;
        }

        .customize-label {
            color: #00ff88;
            font-size: 14px;
            font-weight: bold;
            margin-bottom: 10px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .color-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 10px;
        }

        .color-option {
            width: 100%;
            aspect-ratio: 1;
            border-radius: 12px;
            border: 3px solid rgba(0, 255, 136, 0.2);
            cursor: pointer;
            transition: all 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            position: relative;
        }

        .color-option i {
            color: rgba(255, 255, 255, 0.9);
            font-size: 24px;
            opacity: 0;
            transition: opacity 0.3s;
            text-shadow: 0 2px 4px rgba(0, 0, 0, 0.5);
        }

        .color-option.selected {
            border-color: #00ff88;
            box-shadow: 0 0 20px rgba(0, 255, 136, 0.5);
            transform: scale(1.05);
        }

        .color-option.selected i {
            opacity: 1;
        }

        .color-option:active {
            transform: scale(0.95);
        }

        .shoot-style-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 8px;
        }

        .shoot-style-option {
            background: rgba(13, 27, 42, 0.6);
            border: 2px solid rgba(0, 255, 136, 0.2);
            border-radius: 10px;
            padding: 12px 8px;
            cursor: pointer;
            transition: all 0.3s;
            text-align: center;
        }

        .shoot-style-option:active {
            transform: scale(0.95);
        }

        .shoot-style-option.selected {
            border-color: #00ff88;
            background: rgba(0, 255, 136, 0.15);
        }

        .shoot-style-name {
            color: #00ff88;
            font-size: 13px;
            font-weight: bold;
            margin-bottom: 3px;
        }

        .shoot-style-desc {
            color: rgba(255, 255, 255, 0.6);
            font-size: 11px;
        }

        @media (max-width: 360px) {
            .color-grid {
                gap: 8px;
            }

            .shoot-style-grid {
                gap: 6px;
            }

            .customize-label {
                font-size: 13px;
            }
        }

        .control-btn {
            width: 65px;
            height: 65px;
            background: rgba(13, 27, 42, 0.85);
            border: 2px solid rgba(0, 255, 136, 0.5);
            border-radius: 50%;
            color: #00ff88;
            font-size: 26px;
            display: flex;
            align-items: center;
            justify-content: center;
            touch-action: manipulation;
            user-select: none;
            backdrop-filter: blur(10px);
            box-shadow: 0 4px 15px rgba(0, 255, 136, 0.3);
            transition: all 0.2s;
        }

        .control-btn:active {
            background: rgba(0, 255, 136, 0.3);
            transform: scale(0.92);
            box-shadow: 0 2px 10px rgba(0, 255, 136, 0.5);
        }

        .score-row {
            background: rgba(13, 27, 42, 0.8);
            border: 2px solid rgba(0, 255, 136, 0.2);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 8px;
        }

        .score-label {
            font-size: 12px;
            color: rgba(0, 255, 136, 0.7);
        }

        .score-value {
            font-size: 24px;
            font-weight: bold;
            color: #00ff88;
            text-shadow: 0 0 10px rgba(0, 255, 136, 0.5);
        }

        .progress {
            height: 6px;
            background: rgba(13, 27, 42, 0.8);
            border-radius: 10px;
            overflow: hidden;
        }

        .progress-bar {
            background: linear-gradient(90deg, #00ff88, #00d4ff);
            transition: width 0.3s ease;
        }

        /* –û–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –¥–ª—è –º–∞–ª–µ–Ω—å–∫–∏—Ö —ç–∫—Ä–∞–Ω–æ–≤ */
        @media (max-height: 700px) {
            .game-card {
                padding: 15px 12px;
            }

            .game-title {
                font-size: 28px;
                margin-bottom: 3px;
            }

            .game-subtitle {
                font-size: 10px;
                margin-bottom: 15px;
            }

            .difficulty-card {
                padding: 10px;
                margin-bottom: 8px;
            }

            .difficulty-name {
                font-size: 16px;
            }

            .difficulty-description {
                font-size: 10px;
            }

            .difficulty-icon {
                font-size: 24px;
            }

            .btn-game {
                font-size: 14px;
                padding: 10px 25px;
            }

            .btn-secondary-game {
                font-size: 12px;
                padding: 8px 20px;
            }
        }

        @media (max-width: 360px) {
            .control-btn {
                width: 55px;
                height: 55px;
                font-size: 22px;
            }

            .stat-value {
                font-size: 14px;
            }

            .stat-label {
                font-size: 8px;
            }
        }
    </style>
</head>
<body>
    <!-- –≠–∫—Ä–∞–Ω –≤—ã–±–æ—Ä–∞ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ -->
    <div id="difficultyScreen">
        <div class="game-card">
            <h1 class="game-title">üöÄ SPACE<br>SHOOTER</h1>
            <p class="game-subtitle">–í–´–ë–ï–†–ò–¢–ï –°–õ–û–ñ–ù–û–°–¢–¨</p>

            <div class="difficulty-card" data-difficulty="easy">
                <div class="d-flex align-items-center">
                    <div class="difficulty-icon">üòä</div>
                    <div class="flex-grow-1">
                        <div class="difficulty-name">–õ–µ–≥–∫–æ</div>
                        <div class="difficulty-description">
                            –ú–µ–¥–ª–µ–Ω–Ω—ã–µ –≤—Ä–∞–≥–∏ ‚Ä¢ 5 –∂–∏–∑–Ω–µ–π
                        </div>
                    </div>
                </div>
            </div>

            <div class="difficulty-card" data-difficulty="normal">
                <div class="d-flex align-items-center">
                    <div class="difficulty-icon">üòé</div>
                    <div class="flex-grow-1">
                        <div class="difficulty-name">–ù–æ—Ä–º–∞–ª—å–Ω–æ</div>
                        <div class="difficulty-description">
                            –°–±–∞–ª–∞–Ω—Å–∏—Ä–æ–≤–∞–Ω–Ω–∞—è –∏–≥—Ä–∞ ‚Ä¢ 3 –∂–∏–∑–Ω–∏
                        </div>
                    </div>
                </div>
            </div>

            <div class="difficulty-card" data-difficulty="hard">
                <div class="d-flex align-items-center">
                    <div class="difficulty-icon">üò§</div>
                    <div class="flex-grow-1">
                        <div class="difficulty-name">–°–ª–æ–∂–Ω–æ</div>
                        <div class="difficulty-description">
                            –ë—ã—Å—Ç—Ä—ã–µ –≤—Ä–∞–≥–∏ ‚Ä¢ 2 –∂–∏–∑–Ω–∏
                        </div>
                    </div>
                </div>
            </div>

            <div class="difficulty-card" data-difficulty="nightmare">
                <div class="d-flex align-items-center">
                    <div class="difficulty-icon">üíÄ</div>
                    <div class="flex-grow-1">
                        <div class="difficulty-name">–ö–æ—à–º–∞—Ä</div>
                        <div class="difficulty-description">
                            –≠–∫—Å—Ç—Ä–µ–º–∞–ª—å–Ω–æ ‚Ä¢ 1 –∂–∏–∑–Ω—å ‚Ä¢ –£–¥–∞—á–∏!
                        </div>
                    </div>
                </div>
            </div>

            <div class="form-check mb-3 mt-2" style="text-align: left;">
                <input class="form-check-input" type="checkbox" id="autoShootToggle" checked>
                <label class="form-check-label" for="autoShootToggle" style="color: #00ff88; font-size: 14px;">
                    <i class="bi bi-lightning-fill"></i> –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–µ–ª—å–±–∞
                </label>
            </div>

            <button class="btn btn-game w-100 mb-2" id="startBtn" disabled>
                –ù–ê–ß–ê–¢–¨ –ò–ì–†–£
            </button>
            <button class="btn btn-game btn-secondary-game w-100" id="customizeBtn">
                <i class="bi bi-palette-fill"></i> –ö–ê–°–¢–û–ú–ò–ó–ê–¶–ò–Ø
            </button>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏ -->
    <div id="customizeScreen" style="display: none;">
        <div class="game-card">
            <h1 class="game-title" style="font-size: 28px;">üé® –ö–ê–°–¢–û–ú–ò–ó–ê–¶–ò–Ø</h1>
            <p class="game-subtitle">–ù–ê–°–¢–†–û–ô–¢–ï –°–í–û–ô –ö–û–†–ê–ë–õ–¨</p>

            <!-- –¶–≤–µ—Ç –∫–æ—Ä–∞–±–ª—è -->
            <div class="customize-section">
                <div class="customize-label">
                    <i class="bi bi-brush-fill"></i> –¶–≤–µ—Ç –∫–æ—Ä–∞–±–ª—è
                </div>
                <div class="color-grid">
                    <div class="color-option" data-ship-color="green" style="background: linear-gradient(135deg, #00ff88, #00d4ff);">
                        <i class="bi bi-check-lg"></i>
                    </div>
                    <div class="color-option" data-ship-color="blue" style="background: linear-gradient(135deg, #00d4ff, #0080ff);">
                        <i class="bi bi-check-lg"></i>
                    </div>
                    <div class="color-option" data-ship-color="purple" style="background: linear-gradient(135deg, #a855f7, #ec4899);">
                        <i class="bi bi-check-lg"></i>
                    </div>
                    <div class="color-option" data-ship-color="orange" style="background: linear-gradient(135deg, #ff6b00, #ff9900);">
                        <i class="bi bi-check-lg"></i>
                    </div>
                    <div class="color-option" data-ship-color="red" style="background: linear-gradient(135deg, #ff0066, #ff3366);">
                        <i class="bi bi-check-lg"></i>
                    </div>
                    <div class="color-option" data-ship-color="yellow" style="background: linear-gradient(135deg, #ffd700, #ffed4e);">
                        <i class="bi bi-check-lg"></i>
                    </div>
                </div>
            </div>

            <!-- –¶–≤–µ—Ç –ø—É–ª—å -->
            <div class="customize-section">
                <div class="customize-label">
                    <i class="bi bi-circle-fill"></i> –¶–≤–µ—Ç –ø—É–ª—å
                </div>
                <div class="color-grid">
                    <div class="color-option" data-bullet-color="yellow" style="background: linear-gradient(135deg, #ffff00, #ff9900);">
                        <i class="bi bi-check-lg"></i>
                    </div>
                    <div class="color-option" data-bullet-color="cyan" style="background: linear-gradient(135deg, #00ffff, #00d4ff);">
                        <i class="bi bi-check-lg"></i>
                    </div>
                    <div class="color-option" data-bullet-color="pink" style="background: linear-gradient(135deg, #ff69b4, #ff1493);">
                        <i class="bi bi-check-lg"></i>
                    </div>
                    <div class="color-option" data-bullet-color="green" style="background: linear-gradient(135deg, #00ff88, #00ff00);">
                        <i class="bi bi-check-lg"></i>
                    </div>
                    <div class="color-option" data-bullet-color="white" style="background: linear-gradient(135deg, #ffffff, #cccccc);">
                        <i class="bi bi-check-lg"></i>
                    </div>
                    <div class="color-option" data-bullet-color="purple" style="background: linear-gradient(135deg, #a855f7, #8b5cf6);">
                        <i class="bi bi-check-lg"></i>
                    </div>
                </div>
            </div>

            <!-- –°—Ç–∏–ª—å —Å—Ç—Ä–µ–ª—å–±—ã -->
            <div class="customize-section">
                <div class="customize-label">
                    <i class="bi bi-stars"></i> –°—Ç–∏–ª—å —Å—Ç—Ä–µ–ª—å–±—ã
                </div>
                <div class="shoot-style-grid">
                    <div class="shoot-style-option selected" data-shoot-style="single">
                        <div class="shoot-style-name">–û–¥–∏–Ω–æ—á–Ω–∞—è</div>
                        <div class="shoot-style-desc">1 –ø—É–ª—è</div>
                    </div>
                    <div class="shoot-style-option" data-shoot-style="double">
                        <div class="shoot-style-name">–î–≤–æ–π–Ω–∞—è</div>
                        <div class="shoot-style-desc">2 –ø—É–ª–∏</div>
                    </div>
                    <div class="shoot-style-option" data-shoot-style="triple">
                        <div class="shoot-style-name">–¢—Ä–æ–π–Ω–∞—è</div>
                        <div class="shoot-style-desc">3 –ø—É–ª–∏</div>
                    </div>
                </div>
            </div>

            <!-- –≠—Ñ—Ñ–µ–∫—Ç—ã -->
            <div class="customize-section">
                <div class="form-check" style="text-align: left;">
                    <input class="form-check-input" type="checkbox" id="particlesToggle" checked>
                    <label class="form-check-label" for="particlesToggle" style="color: #00ff88; font-size: 13px;">
                        <i class="bi bi-star-fill"></i> –≠—Ñ—Ñ–µ–∫—Ç—ã —á–∞—Å—Ç–∏—Ü
                    </label>
                </div>
                <div class="form-check mt-2" style="text-align: left;">
                    <input class="form-check-input" type="checkbox" id="glowToggle" checked>
                    <label class="form-check-label" for="glowToggle" style="color: #00ff88; font-size: 13px;">
                        <i class="bi bi-brightness-high-fill"></i> –≠—Ñ—Ñ–µ–∫—Ç—ã —Å–≤–µ—á–µ–Ω–∏—è
                    </label>
                </div>
            </div>

            <div class="d-grid gap-2 mt-3">
                <button class="btn btn-game" id="saveCustomizationBtn">
                    <i class="bi bi-check2-circle"></i> –°–û–•–†–ê–ù–ò–¢–¨
                </button>
                <button class="btn btn-game btn-secondary-game" id="backToMenuBtn">
                    <i class="bi bi-arrow-left"></i> –ù–ê–ó–ê–î
                </button>
            </div>
        </div>
    </div>

    <!-- –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å –∏–≥—Ä—ã -->
    <div id="ui">
        <div class="row g-2">
            <div class="col-4">
                <div class="stat-card">
                    <div class="stat-label">–û—á–∫–∏</div>
                    <div class="stat-value" id="score">0</div>
                </div>
            </div>
            <div class="col-4">
                <div class="stat-card">
                    <div class="stat-label">
                        <i class="bi bi-heart-fill text-danger"></i> –ñ–∏–∑–Ω–∏
                    </div>
                    <div class="stat-value" id="lives">3</div>
                </div>
            </div>
            <div class="col-4">
                <div class="stat-card">
                    <div class="stat-label">–£—Ä–æ–≤–µ–Ω—å</div>
                    <div class="stat-value" id="level">1</div>
                </div>
            </div>
        </div>
        <div class="mt-2">
            <div class="progress">
                <div class="progress-bar" id="levelProgress" role="progressbar" style="width: 0%"></div>
            </div>
        </div>
    </div>

    <!-- –≠–∫—Ä–∞–Ω Game Over -->
    <div id="gameOver" style="display: none;">
        <div class="game-card text-center">
            <h1 class="game-title mb-3">GAME OVER</h1>

            <div class="score-row mb-2">
                <div class="score-label">–í–∞—à —Å—á–µ—Ç</div>
                <div class="score-value" id="finalScore">0</div>
            </div>

            <div class="score-row mb-2">
                <div class="score-label">–î–æ—Å—Ç–∏–≥–Ω—É—Ç—ã–π —É—Ä–æ–≤–µ–Ω—å</div>
                <div class="score-value" id="finalLevel">1</div>
            </div>

            <div class="score-row mb-3">
                <div class="score-label">
                    <i class="bi bi-trophy-fill text-warning"></i> –õ—É—á—à–∏–π —Å—á–µ—Ç
                </div>
                <div class="score-value" id="bestScore">0</div>
            </div>

            <div class="d-grid gap-2">
                <button class="btn btn-game" id="restartBtn">
                    <i class="bi bi-arrow-clockwise"></i> –ò–ì–†–ê–¢–¨ –°–ù–û–í–ê
                </button>
                <button class="btn btn-game btn-secondary-game" id="changeDifficultyBtn">
                    <i class="bi bi-gear-fill"></i> –°–õ–û–ñ–ù–û–°–¢–¨
                </button>
            </div>
        </div>
    </div>

    <canvas id="gameCanvas"></canvas>

    <!-- –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ -->
    <div id="controls">
        <div class="auto-shoot-indicator" id="autoShootIndicator">
            <i class="bi bi-lightning-fill"></i>
            <span id="autoShootText">–ê–í–¢–û</span>
        </div>
        <div class="controls-row">
            <div class="control-btn" id="leftBtn">
                <i class="bi bi-arrow-left"></i>
            </div>
            <div class="control-btn" id="shootBtn">
                <i class="bi bi-circle-fill"></i>
            </div>
            <div class="control-btn" id="rightBtn">
                <i class="bi bi-arrow-right"></i>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const tg = window.Telegram.WebApp;
        tg.expand();
        tg.enableClosingConfirmation();

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        canvas.width = window.innerWidth;
        canvas.height = window.innerHeight;

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        const difficultySettings = {
            easy: {
                name: '–õ–µ–≥–∫–æ',
                lives: 5,
                enemySpeed: 0.7,
                enemySpawnRate: 0.015,
                scoreMultiplier: 1
            },
            normal: {
                name: '–ù–æ—Ä–º–∞–ª—å–Ω–æ',
                lives: 3,
                enemySpeed: 1,
                enemySpawnRate: 0.02,
                scoreMultiplier: 1.5
            },
            hard: {
                name: '–°–ª–æ–∂–Ω–æ',
                lives: 2,
                enemySpeed: 1.5,
                enemySpawnRate: 0.03,
                scoreMultiplier: 2
            },
            nightmare: {
                name: '–ö–æ—à–º–∞—Ä',
                lives: 1,
                enemySpeed: 2,
                enemySpawnRate: 0.04,
                scoreMultiplier: 3
            }
        };

        let currentDifficulty = null;
        let gameStarted = false;
        let gameRunning = false;
        let score = 0;
        let lives = 3;
        let level = 1;
        let levelProgress = 0;
        let bestScore = parseInt(localStorage.getItem('bestScore')) || 0;
        let autoShoot = true; // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–µ–ª—å–±–∞ –≤–∫–ª—é—á–µ–Ω–∞ –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é

        // –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏
        let customization = {
            shipColor: localStorage.getItem('shipColor') || 'green',
            bulletColor: localStorage.getItem('bulletColor') || 'yellow',
            shootStyle: localStorage.getItem('shootStyle') || 'single',
            particles: localStorage.getItem('particles') !== 'false',
            glow: localStorage.getItem('glow') !== 'false'
        };

        // –¶–≤–µ—Ç–æ–≤—ã–µ —Å—Ö–µ–º—ã
        const colorSchemes = {
            ship: {
                green: { primary: '#00ff88', secondary: '#00d4ff', shadow: '#00ff88' },
                blue: { primary: '#00d4ff', secondary: '#0080ff', shadow: '#00d4ff' },
                purple: { primary: '#a855f7', secondary: '#ec4899', shadow: '#a855f7' },
                orange: { primary: '#ff6b00', secondary: '#ff9900', shadow: '#ff6b00' },
                red: { primary: '#ff0066', secondary: '#ff3366', shadow: '#ff0066' },
                yellow: { primary: '#ffd700', secondary: '#ffed4e', shadow: '#ffd700' }
            },
            bullet: {
                yellow: { primary: '#ffff00', secondary: '#ff9900', shadow: '#ffff00' },
                cyan: { primary: '#00ffff', secondary: '#00d4ff', shadow: '#00ffff' },
                pink: { primary: '#ff69b4', secondary: '#ff1493', shadow: '#ff69b4' },
                green: { primary: '#00ff88', secondary: '#00ff00', shadow: '#00ff88' },
                white: { primary: '#ffffff', secondary: '#cccccc', shadow: '#ffffff' },
                purple: { primary: '#a855f7', secondary: '#8b5cf6', shadow: '#a855f7' }
            }
        };

        const player = {
            x: canvas.width / 2,
            y: canvas.height - 100,
            width: 40,
            height: 40,
            speed: 6,
            vx: 0
        };

        const bullets = [];
        const enemies = [];
        const stars = [];
        const particles = [];

        let leftPressed = false;
        let rightPressed = false;
        let shootPressed = false;
        let lastShootTime = 0;
        const shootCooldown = 200;

        // –í—ã–±–æ—Ä —Å–ª–æ–∂–Ω–æ—Å—Ç–∏
        document.querySelectorAll('.difficulty-card').forEach(card => {
            card.addEventListener('click', function() {
                document.querySelectorAll('.difficulty-card').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');
                currentDifficulty = this.getAttribute('data-difficulty');
                document.getElementById('startBtn').disabled = false;
            });
        });

        // –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π —Å—Ç—Ä–µ–ª—å–±—ã
        document.getElementById('autoShootToggle').addEventListener('change', function() {
            autoShoot = this.checked;
            localStorage.setItem('autoShoot', autoShoot);
            updateAutoShootIndicator();
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–≤—Ç–æ—Å—Ç—Ä–µ–ª—å–±—ã –∏–∑ localStorage
        const savedAutoShoot = localStorage.getItem('autoShoot');
        if (savedAutoShoot !== null) {
            autoShoot = savedAutoShoot === 'true';
            document.getElementById('autoShootToggle').checked = autoShoot;
        }

        // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞ –∞–≤—Ç–æ—Å—Ç—Ä–µ–ª—å–±—ã
        function updateAutoShootIndicator() {
            const indicator = document.getElementById('autoShootIndicator');
            const text = document.getElementById('autoShootText');
            if (autoShoot) {
                indicator.classList.add('active');
                text.textContent = '–ê–í–¢–û';
            } else {
                indicator.classList.remove('active');
                text.textContent = '–†–£–ß–ù.';
            }
        }

        // –ü–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏–µ –∞–≤—Ç–æ—Å—Ç—Ä–µ–ª—å–±—ã –≤–æ –≤—Ä–µ–º—è –∏–≥—Ä—ã
        document.getElementById('autoShootIndicator').addEventListener('click', function() {
            autoShoot = !autoShoot;
            localStorage.setItem('autoShoot', autoShoot);
            updateAutoShootIndicator();
        });

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä–∞
        updateAutoShootIndicator();

        // –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è - –æ—Ç–∫—Ä—ã—Ç–∏–µ —ç–∫—Ä–∞–Ω–∞
        document.getElementById('customizeBtn').addEventListener('click', () => {
            document.getElementById('difficultyScreen').style.display = 'none';
            document.getElementById('customizeScreen').style.display = 'flex';
            loadCustomization();
        });

        // –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è - –≤–æ–∑–≤—Ä–∞—Ç
        document.getElementById('backToMenuBtn').addEventListener('click', () => {
            document.getElementById('customizeScreen').style.display = 'none';
            document.getElementById('difficultyScreen').style.display = 'flex';
        });

        // –ö–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏—è - —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
        document.getElementById('saveCustomizationBtn').addEventListener('click', () => {
            saveCustomization();
            document.getElementById('customizeScreen').style.display = 'none';
            document.getElementById('difficultyScreen').style.display = 'flex';
        });

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏
        function loadCustomization() {
            // –¶–≤–µ—Ç –∫–æ—Ä–∞–±–ª—è
            document.querySelectorAll('[data-ship-color]').forEach(el => {
                el.classList.toggle('selected', el.dataset.shipColor === customization.shipColor);
            });

            // –¶–≤–µ—Ç –ø—É–ª—å
            document.querySelectorAll('[data-bullet-color]').forEach(el => {
                el.classList.toggle('selected', el.dataset.bulletColor === customization.bulletColor);
            });

            // –°—Ç–∏–ª—å —Å—Ç—Ä–µ–ª—å–±—ã
            document.querySelectorAll('[data-shoot-style]').forEach(el => {
                el.classList.toggle('selected', el.dataset.shootStyle === customization.shootStyle);
            });

            // –≠—Ñ—Ñ–µ–∫—Ç—ã
            document.getElementById('particlesToggle').checked = customization.particles;
            document.getElementById('glowToggle').checked = customization.glow;
        }

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—ã–±–æ—Ä–∞ —Ü–≤–µ—Ç–∞ –∫–æ—Ä–∞–±–ª—è
        document.querySelectorAll('[data-ship-color]').forEach(el => {
            el.addEventListener('click', function() {
                document.querySelectorAll('[data-ship-color]').forEach(e => e.classList.remove('selected'));
                this.classList.add('selected');
                customization.shipColor = this.dataset.shipColor;
            });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—ã–±–æ—Ä–∞ —Ü–≤–µ—Ç–∞ –ø—É–ª—å
        document.querySelectorAll('[data-bullet-color]').forEach(el => {
            el.addEventListener('click', function() {
                document.querySelectorAll('[data-bullet-color]').forEach(e => e.classList.remove('selected'));
                this.classList.add('selected');
                customization.bulletColor = this.dataset.bulletColor;
            });
        });

        // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –≤—ã–±–æ—Ä–∞ —Å—Ç–∏–ª—è —Å—Ç—Ä–µ–ª—å–±—ã
        document.querySelectorAll('[data-shoot-style]').forEach(el => {
            el.addEventListener('click', function() {
                document.querySelectorAll('[data-shoot-style]').forEach(e => e.classList.remove('selected'));
                this.classList.add('selected');
                customization.shootStyle = this.dataset.shootStyle;
            });
        });

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∫–∞—Å—Ç–æ–º–∏–∑–∞—Ü–∏–∏
        function saveCustomization() {
            customization.particles = document.getElementById('particlesToggle').checked;
            customization.glow = document.getElementById('glowToggle').checked;

            localStorage.setItem('shipColor', customization.shipColor);
            localStorage.setItem('bulletColor', customization.bulletColor);
            localStorage.setItem('shootStyle', customization.shootStyle);
            localStorage.setItem('particles', customization.particles);
            localStorage.setItem('glow', customization.glow);
        }

        document.getElementById('startBtn').addEventListener('click', () => {
            if (currentDifficulty) {
                document.getElementById('difficultyScreen').style.display = 'none';
                startGame();
            }
        });

        document.getElementById('restartBtn').addEventListener('click', () => {
            document.getElementById('gameOver').style.display = 'none';
            startGame();
        });

        document.getElementById('changeDifficultyBtn').addEventListener('click', () => {
            document.getElementById('gameOver').style.display = 'none';
            document.getElementById('difficultyScreen').style.display = 'flex';
            currentDifficulty = null;
            document.getElementById('startBtn').disabled = true;
            document.querySelectorAll('.difficulty-card').forEach(c => c.classList.remove('selected'));
        });

        // –ó–≤–µ–∑–¥–Ω–æ–µ –ø–æ–ª–µ
        for (let i = 0; i < 100; i++) {
            stars.push({
                x: Math.random() * canvas.width,
                y: Math.random() * canvas.height,
                size: Math.random() * 2,
                speed: Math.random() * 2 + 0.5,
                opacity: Math.random() * 0.5 + 0.5
            });
        }

        // –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ
        document.getElementById('leftBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            leftPressed = true;
        });
        document.getElementById('leftBtn').addEventListener('touchend', () => leftPressed = false);

        document.getElementById('rightBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            rightPressed = true;
        });
        document.getElementById('rightBtn').addEventListener('touchend', () => rightPressed = false);

        document.getElementById('shootBtn').addEventListener('touchstart', (e) => {
            e.preventDefault();
            shootPressed = true;
        });
        document.getElementById('shootBtn').addEventListener('touchend', () => shootPressed = false);

        // –ö–ª–∞–≤–∏–∞—Ç—É—Ä–∞
        document.addEventListener('keydown', (e) => {
            if (e.key === 'ArrowLeft') leftPressed = true;
            if (e.key === 'ArrowRight') rightPressed = true;
            if (e.key === ' ') {
                e.preventDefault();
                shootPressed = true;
            }
        });

        document.addEventListener('keyup', (e) => {
            if (e.key === 'ArrowLeft') leftPressed = false;
            if (e.key === 'ArrowRight') rightPressed = false;
            if (e.key === ' ') shootPressed = false;
        });

        function startGame() {
            const settings = difficultySettings[currentDifficulty];
            gameStarted = true;
            gameRunning = true;
            score = 0;
            lives = settings.lives;
            level = 1;
            levelProgress = 0;
            bullets.length = 0;
            enemies.length = 0;
            particles.length = 0;
            player.x = canvas.width / 2;
            updateUI();
            gameLoop();
        }

        function shoot() {
            const now = Date.now();
            if (now - lastShootTime > shootCooldown) {
                const bulletData = {
                    y: player.y,
                    width: 5,
                    height: 18,
                    speed: 10
                };

                if (customization.shootStyle === 'single') {
                    // –û–¥–∏–Ω–æ—á–Ω–∞—è –ø—É–ª—è
                    bullets.push({
                        ...bulletData,
                        x: player.x
                    });
                } else if (customization.shootStyle === 'double') {
                    // –î–≤–æ–π–Ω–∞—è –ø—É–ª—è
                    bullets.push({
                        ...bulletData,
                        x: player.x - 10
                    });
                    bullets.push({
                        ...bulletData,
                        x: player.x + 10
                    });
                } else if (customization.shootStyle === 'triple') {
                    // –¢—Ä–æ–π–Ω–∞—è –ø—É–ª—è
                    bullets.push({
                        ...bulletData,
                        x: player.x - 15
                    });
                    bullets.push({
                        ...bulletData,
                        x: player.x
                    });
                    bullets.push({
                        ...bulletData,
                        x: player.x + 15
                    });
                }

                lastShootTime = now;
            }
        }

        function spawnEnemy() {
            const settings = difficultySettings[currentDifficulty];
            const size = 30 + Math.random() * 25;
            enemies.push({
                x: Math.random() * (canvas.width - size),
                y: -size,
                width: size,
                height: size,
                speed: (1 + level * 0.3 + Math.random() * 2) * settings.enemySpeed,
                health: 1 + Math.floor(level / 3),
                maxHealth: 1 + Math.floor(level / 3)
            });
        }

        function createExplosion(x, y, color = '#ff6b00') {
            if (!customization.particles) return; // –ü—Ä–æ–ø—É—Å—Ç–∏—Ç—å –µ—Å–ª–∏ —ç—Ñ—Ñ–µ–∫—Ç—ã –≤—ã–∫–ª—é—á–µ–Ω—ã

            for (let i = 0; i < 30; i++) {
                particles.push({
                    x: x,
                    y: y,
                    vx: (Math.random() - 0.5) * 10,
                    vy: (Math.random() - 0.5) * 10,
                    life: 1,
                    decay: 0.015,
                    color: color
                });
            }
        }

        function updateUI() {
            document.getElementById('score').textContent = score;
            document.getElementById('lives').textContent = lives;
            document.getElementById('level').textContent = level;

            const progressPercent = (levelProgress % 200) / 200 * 100;
            document.getElementById('levelProgress').style.width = progressPercent + '%';
        }

        function gameOver() {
            gameRunning = false;
            if (score > bestScore) {
                bestScore = score;
                localStorage.setItem('bestScore', bestScore);

                // –û—Ç–ø—Ä–∞–≤–∫–∞ –¥–∞–Ω–Ω—ã—Ö –≤ Telegram
                if (tg.initDataUnsafe?.user) {
                    tg.sendData(JSON.stringify({
                        score: score,
                        level: level,
                        difficulty: currentDifficulty,
                        userId: tg.initDataUnsafe.user.id
                    }));
                }
            }

            document.getElementById('finalScore').textContent = score;
            document.getElementById('finalLevel').textContent = level;
            document.getElementById('bestScore').textContent = bestScore;
            document.getElementById('gameOver').style.display = 'flex';
        }

        function update() {
            if (!gameRunning) return;

            const settings = difficultySettings[currentDifficulty];

            // –î–≤–∏–∂–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞
            player.vx = 0;
            if (leftPressed) player.vx = -player.speed;
            if (rightPressed) player.vx = player.speed;
            player.x += player.vx;
            player.x = Math.max(player.width / 2, Math.min(canvas.width - player.width / 2, player.x));

            // –°—Ç—Ä–µ–ª—å–±–∞
            if (autoShoot) {
                // –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å—Ç—Ä–µ–ª—å–±–∞
                shoot();
            } else {
                // –†—É—á–Ω–∞—è —Å—Ç—Ä–µ–ª—å–±–∞ (—Ç–æ–ª—å–∫–æ –ø—Ä–∏ –Ω–∞–∂–∞—Ç–∏–∏)
                if (shootPressed) shoot();
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –∑–≤–µ–∑–¥
            stars.forEach(star => {
                star.y += star.speed;
                if (star.y > canvas.height) {
                    star.y = 0;
                    star.x = Math.random() * canvas.width;
                }
            });

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—É–ª—å
            for (let i = bullets.length - 1; i >= 0; i--) {
                bullets[i].y -= bullets[i].speed;
                if (bullets[i].y < 0) {
                    bullets.splice(i, 1);
                }
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ –≤—Ä–∞–≥–æ–≤
            for (let i = enemies.length - 1; i >= 0; i--) {
                enemies[i].y += enemies[i].speed;

                if (enemies[i].y > canvas.height) {
                    enemies.splice(i, 1);
                    lives--;
                    updateUI();
                    if (lives <= 0) gameOver();
                }
            }

            // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è –ø—É–ª—å —Å –≤—Ä–∞–≥–∞–º–∏
            for (let i = bullets.length - 1; i >= 0; i--) {
                for (let j = enemies.length - 1; j >= 0; j--) {
                    if (bullets[i] && enemies[j] &&
                        bullets[i].x > enemies[j].x - enemies[j].width / 2 &&
                        bullets[i].x < enemies[j].x + enemies[j].width / 2 &&
                        bullets[i].y > enemies[j].y - enemies[j].height / 2 &&
                        bullets[i].y < enemies[j].y + enemies[j].height / 2) {

                        bullets.splice(i, 1);
                        enemies[j].health--;

                        if (enemies[j].health <= 0) {
                            createExplosion(enemies[j].x, enemies[j].y, '#ff6b00');
                            enemies.splice(j, 1);
                            const points = Math.floor(10 * level * settings.scoreMultiplier);
                            score += points;
                            levelProgress += points;
                            updateUI();

                            if (levelProgress >= 200) {
                                level++;
                                levelProgress = 0;
                                updateUI();
                            }
                        }
                        break;
                    }
                }
            }

            // –°—Ç–æ–ª–∫–Ω–æ–≤–µ–Ω–∏—è —Å –∏–≥—Ä–æ–∫–æ–º
            for (let i = enemies.length - 1; i >= 0; i--) {
                if (Math.abs(enemies[i].x - player.x) < (enemies[i].width + player.width) / 2 &&
                    Math.abs(enemies[i].y - player.y) < (enemies[i].height + player.height) / 2) {
                    createExplosion(player.x, player.y, '#00ff88');
                    enemies.splice(i, 1);
                    lives--;
                    updateUI();
                    if (lives <= 0) gameOver();
                }
            }

            // –û–±–Ω–æ–≤–ª–µ–Ω–∏–µ —á–∞—Å—Ç–∏—Ü
            for (let i = particles.length - 1; i >= 0; i--) {
                particles[i].x += particles[i].vx;
                particles[i].y += particles[i].vy;
                particles[i].life -= particles[i].decay;
                if (particles[i].life <= 0) {
                    particles.splice(i, 1);
                }
            }

            // –°–ø–∞–≤–Ω –≤—Ä–∞–≥–æ–≤
            if (Math.random() < settings.enemySpawnRate + level * 0.003) {
                spawnEnemy();
            }
        }

        function draw() {
            // –ì—Ä–∞–¥–∏–µ–Ω—Ç–Ω—ã–π —Ñ–æ–Ω
            const gradient = ctx.createLinearGradient(0, 0, 0, canvas.height);
            gradient.addColorStop(0, '#0a0a1a');
            gradient.addColorStop(0.5, '#1a0a2e');
            gradient.addColorStop(1, '#0a0a1a');
            ctx.fillStyle = gradient;
            ctx.fillRect(0, 0, canvas.width, canvas.height);

            // –ó–≤–µ–∑–¥—ã
            stars.forEach(star => {
                ctx.fillStyle = `rgba(255, 255, 255, ${star.opacity})`;
                ctx.fillRect(star.x, star.y, star.size, star.size);
            });

            // –ò–≥—Ä–æ–∫
            ctx.save();
            const shipColors = colorSchemes.ship[customization.shipColor];

            if (customization.glow) {
                ctx.shadowBlur = 20;
                ctx.shadowColor = shipColors.shadow;
            }

            const playerGradient = ctx.createLinearGradient(
                player.x - player.width / 2, player.y - player.height / 2,
                player.x + player.width / 2, player.y + player.height / 2
            );
            playerGradient.addColorStop(0, shipColors.primary);
            playerGradient.addColorStop(1, shipColors.secondary);
            ctx.fillStyle = playerGradient;

            ctx.beginPath();
            ctx.moveTo(player.x, player.y - player.height / 2);
            ctx.lineTo(player.x - player.width / 2, player.y + player.height / 2);
            ctx.lineTo(player.x, player.y + player.height / 4);
            ctx.lineTo(player.x + player.width / 2, player.y + player.height / 2);
            ctx.closePath();
            ctx.fill();
            ctx.restore();

            // –ü—É–ª–∏
            bullets.forEach(bullet => {
                ctx.save();
                const bulletColors = colorSchemes.bullet[customization.bulletColor];

                if (customization.glow) {
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = bulletColors.shadow;
                }

                const bulletGradient = ctx.createLinearGradient(
                    bullet.x, bullet.y,
                    bullet.x, bullet.y + bullet.height
                );
                bulletGradient.addColorStop(0, bulletColors.primary);
                bulletGradient.addColorStop(1, bulletColors.secondary);
                ctx.fillStyle = bulletGradient;

                ctx.fillRect(
                    bullet.x - bullet.width / 2,
                    bullet.y,
                    bullet.width,
                    bullet.height
                );
                ctx.restore();
            });

            // –í—Ä–∞–≥–∏
            enemies.forEach(enemy => {
                ctx.save();

                if (customization.glow) {
                    ctx.shadowBlur = 15;
                    ctx.shadowColor = '#ff0066';
                }

                const enemyGradient = ctx.createRadialGradient(
                    enemy.x, enemy.y, 0,
                    enemy.x, enemy.y, enemy.width / 2
                );
                enemyGradient.addColorStop(0, '#ff0066');
                enemyGradient.addColorStop(1, '#cc0033');
                ctx.fillStyle = enemyGradient;

                ctx.fillRect(
                    enemy.x - enemy.width / 2,
                    enemy.y - enemy.height / 2,
                    enemy.width,
                    enemy.height
                );

                // –ü–æ–ª–æ—Å–∫–∞ –∑–¥–æ—Ä–æ–≤—å—è
                if (enemy.health < enemy.maxHealth) {
                    const healthBarWidth = enemy.width;
                    const healthBarHeight = 4;
                    const healthPercent = enemy.health / enemy.maxHealth;

                    ctx.fillStyle = 'rgba(0, 0, 0, 0.5)';
                    ctx.fillRect(
                        enemy.x - healthBarWidth / 2,
                        enemy.y - enemy.height / 2 - 8,
                        healthBarWidth,
                        healthBarHeight
                    );

                    ctx.fillStyle = healthPercent > 0.5 ? '#00ff88' : '#ff6b00';
                    ctx.fillRect(
                        enemy.x - healthBarWidth / 2,
                        enemy.y - enemy.height / 2 - 8,
                        healthBarWidth * healthPercent,
                        healthBarHeight
                    );
                }

                ctx.restore();
            });

            // –ß–∞—Å—Ç–∏—Ü—ã
            particles.forEach(particle => {
                ctx.fillStyle = `${particle.color}${Math.floor(particle.life * 255).toString(16).padStart(2, '0')}`;
                ctx.fillRect(particle.x, particle.y, 4, 4);
            });
        }

        function gameLoop() {
            if (gameRunning) {
                update();
                draw();
                requestAnimationFrame(gameLoop);
            }
        }

        window.addEventListener('resize', () => {
            canvas.width = window.innerWidth;
            canvas.height = window.innerHeight;
            player.x = canvas.width / 2;
        });
    </script>
</body>
</html>